# ã¯ã˜ã‚ã«

æœ€è¿‘æ°—ã«ãªã£ã¦ã„ãŸ Apollo ã«ã¤ã„ã¦ã€1 ã‹ã‚‰èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚
æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªèª­è€…ã‚’å¯¾è±¡ã«ã—ã¦ã„ã¾ã™ã€‚

- Apollo ã£ã¦èã„ãŸã“ã¨ã¯ã‚ã‚‹ã‘ã©ã€ä½•ãŒã§ãã‚‹ã®ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„
- æ°—ã«ã¯ãªã£ã¦ãŸã‘ã©ã€æ—¥æœ¬èªã®æƒ…å ±ãŒå°‘ãªãã¦èª¿ã¹ã‚‹æ°—ã«ãªã‚Œãªã„
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ„ãƒ¼ãƒ«ãªã®ã‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ„ãƒ¼ãƒ«ãªã®ã‹ã€è©±ã¯ãã‚Œã‹ã‚‰ã 

## æœ¬è¨˜äº‹ã®å†…å®¹

- Apollo ã®ç°¡å˜ãªæ¦‚è¦
- Apollo ã‚’ä½¿ã£ã¦ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚’å»ºã¦ã¦ã¿ã‚‹
- Apollo ã‚’ä½¿ã£ã¦ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹ React ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã‚‹

## Apollo ã®ç°¡å˜ãªæ¦‚è¦

å…¬å¼ãƒšãƒ¼ã‚¸ã¯[ã“ã“](https://www.apollographql.com/)ã§ã™ã€‚
ä»¥ä¸‹ã®ç”»åƒãŒæ€æƒ³ã®å…¨ã¦ã‚’èªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

![Apollo ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](https://d33wubrfki0l68.cloudfront.net/c2582a3fd19bfdfc97d0144244265b2a05827467/58ebe/static/connect-easily-card-231b870a76a571c94740e1fc7c66b13a.png)

**ã™ã¹ã¦ãŒ A**(pollo)**ã«ãªã‚‹ã€‚**

Apollo ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ã‚‰ã‚†ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒ GraphQL ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦é›†ç´„ã•ã‚Œã¾ã™ã€‚
ã“ã†ã™ã‚‹ã“ã¨ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è¤‡é›‘æ€§ãŒ Apollo ã«ã‚ˆã£ã¦éš è”½ã•ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŠã‚ˆã³ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ Apollo ã‚µãƒ¼ãƒãƒ¼ã¨ã®æ¥ç¶šã«ã®ã¿æ³¨æ„ã™ã‚Œã°ã‚ˆããªã‚‹ã‚ã‘ã§ã™ã€‚
ä¾‹ãˆã° REST ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ GraphQL ã‚µãƒ¼ãƒãƒ¼ã«ç§»è¡Œã—ãŸã„ã®ã§ã‚ã‚Œã°ã€ä¸€åº¦ Apollo ã‚’é–“ã«æŒŸã‚“ã§ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã§ãã‚‹çŠ¶æ…‹ã«ã—ã¦ãŠãã€å¾Œã‹ã‚‰æ®µéšçš„ã«ç§»è¡Œã—ã¦ã„ãã€ãªã©ã¨ã„ã†æ–¹æ³•ãŒã¨ã‚Œã¾ã™ã­ã€‚
ä¸€æ–¹ã§ã€é›†ç´„å…ˆã¨ãªã‚‹ GraphQL ã‚µãƒ¼ãƒãƒ¼ãŒå·¨å¤§ã‹ã¤è¤‡é›‘ã«ãªã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚ã“ã®å•é¡Œã«ã¤ã„ã¦ã¯ã€[Apollo Federation](https://www.apollographql.com/docs/apollo-server/federation/introduction/)ã¨ã„ã† GraphQL ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆæ©Ÿèƒ½ã§ç·©å’Œã•ã›ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚é›°å›²æ°—ã ã‘ã§ã‚‚çŸ¥ã‚ŠãŸã„æ–¹ã¯[ã“ã¡ã‚‰ã®è¨˜äº‹](https://blog.h-sakano.dev/entry/2019/12/11/154926)ãŒãŠå‹§ã‚ã§ã™ã€‚

### Apollo ã§ã§ãã‚‹ã“ã¨

- GraphQL ã‚µãƒ¼ãƒãƒ¼ãŒç°¡å˜ã«æ§‹ç¯‰ã§ãã‚‹
- å„ç¨®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ±åˆã—ã€1 ã¤ã® GraphQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é›†ç´„ã§ãã‚‹(æœ¬è¨˜äº‹ã§ã¯è§¦ã‚Œãªã„)
- é›†ç´„ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ©ãƒ•åŒ–ã—ã€è¦–è¦šçš„ã«ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹(æœ¬è¨˜äº‹ã§ã¯è§¦ã‚Œãªã„)
- GraphQL ã‚’åˆ©ç”¨ã™ã‚‹ JavaScript ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªãŒç°¡å˜ã«ä½œæˆã§ãã‚‹

## Apollo Server ã‚’ä½¿ã£ã¦ã¿ã‚‹

ãã‚Œã§ã¯ã€Apollo Server ã§ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
[å…¬å¼ã® Get started](https://www.apollographql.com/docs/apollo-server/getting-started/)ã‚’å‚è€ƒã«é€²ã‚ã¦ã„ãã¾ã™ã€‚

```console
$ mkdir server
$ cd server
$ yarn init
$ yarn add apollo-server graphql
$ touch index.js
```

```javascript:index.js
const { ApolloServer, gql } = require("apollo-server");

// ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
const typeDefs = gql`
  type Book {
    title: String
    author: String
  }

  type Query {
    books: [Book]
  }
`;

const books = [
  {
    title: "Harry Potter and the Chamber of Secrets",
    author: "J.K. Rowling"
  },
  {
    title: "Jurassic Park",
    author: "Michael Crishton"
  }
];

// booksã‚¯ã‚¨ãƒªç™ºè¡Œæ™‚ã®å‡¦ç†ã‚’æŒ‡å®š
const resolvers = {
  Query: {
    books: () => books
  }
};

// ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
const server = new ApolloServer({ typeDefs, resolvers });

server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```

node ã§èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 4000 ç•ªãƒãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€URL ã¯`http://localhost:4000/`ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ã“ã® URL ã«ã‚¯ã‚¨ãƒªã‚’æŠ•ã’ã‚‹ã€ã‚ã‚‹ã„ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚Œã° OK ã§ã™ã€‚

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãã®ã¾ã¾ã®ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€ã“ã‚Œã£ã¦ã‚‚ã®ã™ã”ã„ã‚³ãƒ¼ãƒ‰ã ã¨æ€ã„ã¾ã›ã‚“ã‹?
ä¸Šè¨˜ã‹ã‚‰å¤§äº‹ãªéƒ¨åˆ†ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦ã¿ã‚‹ã¨ã€ã“ã‚Œã£ã½ã£ã¡ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚

```javascript
const { ApolloServer, gql } = require("apollo-server");

const typeDefs = gql`{ã‚¹ã‚­ãƒ¼ãƒå®šç¾©}`;

const resolvers = {
  Query: {
    // ã‚¯ã‚¨ãƒªã«å¿œã˜ãŸé–¢æ•°ã®ç™»éŒ²
  }
};

// ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
const server = new ApolloServer({ typeDefs, resolvers });
server.listen().then(({ url }) => {
  // èµ·å‹•æ™‚å‡¦ç†
});
```

ã“ã‚Œã ã‘ã§ GraphQL ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚‹ã‚“ã§ã™ã€‚
ã—ã‹ã‚‚ã€ã‚¯ã‚¨ãƒªã«ç™»éŒ²ã™ã‚‹é–¢æ•°ã¯è¿”ã‚Šå€¤ã®å‹ã•ãˆå®ˆã£ã¦ã„ã‚Œã° OK ãªã‚ã‘ã§ã™ã€‚å®šæ•°ã‚’è¿”ã—ã¦ã‚‚è£ã§ REST ã‚’å©ã„ã¦ã‚‚ DB æ¥ç¶šã—ã¦ã‚‚ãŠæ§‹ã„ãªã—ã€‚é–‹ç™ºè€…ã®è‡ªç”±ã§ã™ã€‚
æœ¬æ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã¯ãã†ã„ã†ã‚‚ã®ã§ã™ãŒã€å¿…è¦ååˆ†ãªã‚¹ãƒãƒ¼ãƒˆã•ãŒç¾ã—ãæ„Ÿã˜ã‚‹ã®ã¯ç§ã ã‘ã§ã—ã‚‡ã†ã‹ã€‚

## Apollo Client ã‚’ä½¿ã£ã¦ã¿ã‚‹

GraphQL ã® API ã‚µãƒ¼ãƒãƒ¼ãŒç”¨æ„ã§ããŸã®ã§ã€æ¬¡ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚Angularã€Vueã€Svelte ãªã©ã€ãƒ¢ãƒ€ãƒ³ãª JavaScript ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¸€é€šã‚Šç”¨æ„ã—ã¦ã‚ã‚‹ã‚ˆã†ã§ã™ãŒã€ä»Šå›ã¯ React ã‚’ä½¿ã„ã¾ã™ã€‚
ä¾‹ã«ã‚ˆã£ã¦[å…¬å¼ã® Get started](https://www.apollographql.com/docs/react/get-started/)ã‚’å‚è€ƒã«ã—ã¾ã™ãŒã€å†…å®¹ã¯ã ã„ã¶å¤‰ã‚ã‚Šã¾ã™ã€‚

```console
$ mkdir client
$ cd client
$ yarn create react-app .
$ yarn add apollo-boost @apllo/react-hooks graphql
```

`src/App.js`ã®ä¸­èº«ã‚’å…¨ã¦æ¶ˆã—ã¦ã€ä»¥ä¸‹ã®é€šã‚Šã«æ›¸ãæ›ãˆã¾ã™ã€‚

```javascript:App.js
import React, { useMemo } from "react";
import ApolloClient, { gql } from "apollo-boost";
import { ApolloProvider, useQuery } from "@apollo/react-hooks";

const App = () => {
  // Apollo Clientã®åˆæœŸåŒ–
  const client = useMemo(
    () => new ApolloClient({ uri: "http://localhost:4000" }),
    []
  );

  return (
    <div className="App">
      <ApolloProvider client={client}>
        <div>
          <h2>
            My first Apollo app{" "}
            <span role="img" aria-label="Rocket">
              ğŸš€
            </span>
          </h2>
          <Books />
        </div>
      </ApolloProvider>
    </div>
  );
};

const Books = () => {
  // ç™ºè¡Œã‚¯ã‚¨ãƒªã®å®šç¾©
  const booksQuery = useMemo(
    () => gql`
      {
        books {
          title
          author
        }
      }
    `,
    []
  );

  // ã‚¯ã‚¨ãƒªã®ç™ºè¡Œ
  const { loading, error, data } = useQuery(booksQuery);

  // çµæœã®è¡¨ç¤º
  if (loading) return <p>Loading...</p>;
  if (error) return <p>Error :(</p>;

  return data.books.map(({ title, author }, index) => (
    <div key={title}>
      <h3>book{index + 1}</h3>
      <p>title:{title}</p>
      <p>author:{author}</p>
    </div>
  ));
};

export default App;
```

`ApolloProvider`ã¯[ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆ](https://ja.reactjs.org/docs/context.html)ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã­ã€‚
`useQuery`ã¯å†…éƒ¨ã§[`useContext`](https://ja.reactjs.org/docs/hooks-reference.html#usecontext)ã‚’å‘¼ã³å‡ºã™[ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯](https://ja.reactjs.org/docs/hooks-custom.html)ã®ã‚ˆã†ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã©ã“ã‹ã‚‰ã§ã‚‚ã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã§ã¯å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å‰è¿°ã® Apollo Server ãŒèµ·å‹•ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã€Apollo Client ã‚’èµ·å‹•ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

![ApolloClient.JPG](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/213374/a5e82678-7565-6d67-7341-e93ad024bd2d.jpeg)

å…ˆã»ã©ä½œæˆã—ãŸ Apollo Server ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¦ã„ã‚‹ã‚ˆã†ã§ã™ã­ã€‚ã‚µã‚¯ãƒƒã¨ GraphQL ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªãŒä½œæˆã§ãã¾ã—ãŸã€‚

## ãŠã‚ã‚Šã«

ã¨ã„ã†ã‚ã‘ã§ã€Apollo ã‚’ä½¿ã£ã¦ã‚µã‚¯ãƒƒã¨ã‚¢ãƒ—ãƒªã‚’ä½œã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
[Prisma](https://github.com/prisma/prisma2)ã‚„[GraphQL code generator](https://graphql-code-generator.com/)ã¨çµ„ã¿åˆã‚ã›ã‚Œã°å¿«é©ãª GraphQL ãƒ©ã‚¤ãƒ•ã‚’éã”ã›ã‚‹ã‚ˆã†ã«ãªã‚Šãã†ã§ã™ã€‚
ãªãŠã€ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã‚’ monorepo å½¢å¼ãŠã‚ˆã³ TypeScript ã§ã–ã£ãã‚Šæ›¸ã„ãŸã‚‚ã®ã¯[ã“ã¡ã‚‰](https://github.com/igm50/apollo-test)ã«ãªã‚Šã¾ã™ã€‚

ãªãŠã€Apollo ãŒä¸»çœ¼ã«ç½®ã„ã¦ã„ã‚‹ã®ã¯ãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ•ã®ã‚ˆã†ã§ã™ã€‚[Docs ã®ãƒˆãƒƒãƒ—](https://www.apollographql.com/docs/)ã§ã‚ã–ã‚ã–å¤ªå­—ã«ã•ã‚Œã¦ã„ã‚‹ãã‚‰ã„ã€‚
ä»Šå›ã¯ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œã‚‹ã ã‘ã«ã¨ã©ã‚ã¾ã—ãŸãŒã€ã¾ãŸé©å½“ãªã¨ãã«è§¦ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ãã‚Œã§ã¯è‰¯ã„ãŠå¹´ã‚’ï¼

## å‚è€ƒæ–‡çŒ®

[Apollo](https://www.apollographql.com/)
[Apollo Documentation Home](https://www.apollographql.com/docs/)
[TypeScript + Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¯ã˜ã‚ã‹ãŸ 2019](https://qiita.com/notakaos/items/3bbd2293e2ff286d9f49#7-%E9%96%8B%E7%99%BA%E3%81%AE%E5%8A%B9%E7%8E%87%E3%82%92%E3%81%82%E3%81%92%E3%82%8B-ts-node--ts-node-dev)
[monorepo ã«ã¤ã„ã¦èª¿ã¹ãŸ](https://qiita.com/macoshita/items/0c7bfc162e4a6db26219)
[yarn ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹](https://yarnpkg.com/lang/ja/docs/workspaces/)
[GraphQL ã§ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãª Form Validation](https://qiita.com/seya/items/d07194509e861859a410)
[Apollo Federation ã®ã™ã‚ã‚ -GraphQL ã¨ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹-](https://blog.h-sakano.dev/entry/2019/12/11/154926)
